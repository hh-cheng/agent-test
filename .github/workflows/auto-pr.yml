name: Auto PR Creation

on:
  push:
    branches:
      - '**'  # 监听所有分支
  workflow_dispatch:  # 允许手动触发工作流

jobs:
  create_pr:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Git
        run: |
          git config --global user.name "Your Name"
          git config --global user.email "your-email@example.com"

      - name: Create a new branch for PR
        run: |
          git checkout -b "codex-results-${{ github.run_id }}"

      - name: Detect changes
        id: changes
        run: |
          if git status --porcelain | grep -q .; then
            echo "has_changes=true" >> "$GITHUB_OUTPUT"
          else
            echo "has_changes=false" >> "$GITHUB_OUTPUT"
          fi

      - name: Add changes to git
        if: ${{ steps.changes.outputs.has_changes == 'true' }}
        run: |
          git add .
          git commit -m "Codex results: Update"
          git push origin "codex-results-${{ github.run_id }}"

      - name: Create a pull request
        if: ${{ steps.changes.outputs.has_changes == 'true' }}
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: "Codex results: Update"
          body: "This PR includes the latest results from Codex."
          head: "codex-results-${{ github.run_id }}"
          base: "${{ github.ref_name }}"  # 目标为触发分支
