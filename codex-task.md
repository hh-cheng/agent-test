基于当前项目的最新实现，完善并实现以下功能与约束:

## 目标
1. 扩展 TODO List 数据结构，允许一个 TODO 下包含多个子 TODO。
2. 接入 next-auth 并增加登录页，先使用固定账号密码进行登录验证。
3. 增加子 TODO 排序、批量操作与进度展示功能。
4. 增加子 TODO 过滤、搜索与优先级批量设置功能。
5. 增加导出、撤销与快捷键支持。

## 功能范围与需求细节
### 1) TODO 数据结构扩展
- 一个 TODO 可以拥有 0..N 个子 TODO。
- 子 TODO 与父 TODO 的展示需具备层级关系（例如缩进或视觉分组）。
- 子 TODO 具备与父 TODO 一致的核心字段：`id`、`title`、`completed`、`createdAt`（如当前已有字段，请保持兼容）。
- 子 TODO 需要新增 `priority` 字段（高/中/低），用于批量设置与过滤展示。
- 支持新增/编辑/删除/完成子 TODO。
- 父 TODO 的完成状态与子 TODO 的关系需要明确:
  - 若父 TODO 被标记完成，子 TODO 默认也标记完成。
  - 若所有子 TODO 完成，父 TODO 允许自动完成（如当前项目存在完成状态派生逻辑，请与之对齐）。
- 需要避免破坏现有数据与 UI 行为；若已有存量数据，迁移逻辑需安全。
  - 子 TODO 需支持排序（同一父级下可拖拽调整顺序）。
  - 同一父 TODO 下支持对子 TODO 进行批量完成与批量删除。
  - 父 TODO 显示进度（已完成子项 / 总子项），并在列表中可见。

### 2) 账号登录与权限
- 使用 next-auth 进行登录流程，新增独立登录页（如 `/login`）。
- 固定账号密码:
  - 账号: `todolistusername`
  - 密码: `todolistpwd`
- 登录页包含账号、密码输入与提交按钮，错误时展示明确提示。
- 未登录用户访问核心页面时需要引导到登录页。
- 登录后访问 TODO 功能页，登出后无法访问受保护页面。

## UI/交互要求
- TODO 列表需清晰区分父/子 TODO。
- 子 TODO 的操作入口（新增、完成、删除）需直观可用。
- 子 TODO 拖拽排序需有明确可操作区域（如拖拽把手）。
- 批量操作需有清晰入口（如多选 + 批量按钮）。
- 进度展示需在父 TODO 处可一眼识别（数字或进度条）。
- 提供子 TODO 过滤器（全部/仅未完成/仅已完成）。
- 提供子 TODO 搜索输入框（按标题关键词匹配）。
- 提供子 TODO 批量设置优先级入口（高/中/低）。
- 提供 CSV 导出入口（包含父/子层级字段）。
- 提供撤销入口（Undo 最近一次操作）。
- 提供快捷键提示与支持（例如新增子 TODO、批量完成）。
- 登录状态在界面上可见（例如显示当前用户或登出按钮）。

## 验收标准
- 可以创建包含多个子 TODO 的父 TODO，并对每个子 TODO 进行完整 CRUD 操作。
- 父/子 TODO 完成状态逻辑符合上述约束。
- 子 TODO 可拖拽排序，排序结果可持久化。
- 子 TODO 支持批量完成与批量删除，并有明确 UI 入口。
- 父 TODO 显示子项完成进度且数据准确。
- 子 TODO 可按完成状态过滤与关键词搜索。
- 子 TODO 支持批量设置优先级，优先级展示清晰可见。
- 支持导出 CSV（父/子层级信息完整、字段清晰）。
- 支持撤销最近一次操作（至少覆盖新增/删除/完成操作之一）。
- 支持快捷键操作并在界面展示提示。
- 未登录用户无法访问 TODO 功能页，登录成功后可正常使用。
- 使用固定账号密码可完成登录；错误凭证会被提示。

## 约束与说明
- 尽量复用现有代码结构与样式，避免大范围重构。
- 若需要新增依赖，请在 PR 说明中解释用途。


# Trigger Comment
### 🤖 Gemini 代码审计报告

@codex address this feedback

### 5.1 总结

*   **PR 意图概述**：此 PR 为 TODO List 应用增加了三个核心功能：1) 通过记录状态历史实现撤销（Undo）操作；2) 将 TODO 列表导出为 CSV 文件；3) 增加全局和局部的快捷键以提升操作效率。
*   **风险评级**：Low
*   **是否可合并**：No (存在 3 个阻断项)

### 5.2 需求覆盖矩阵 (Product Coverage Matrix)

*   [x] **功能点：提供 CSV 导出入口** - 已实现。代码位于  的  函数及相关按钮。
*   [x] **功能点：提供撤销入口** - 已实现。代码位于  的  函数及相关按钮，所有状态变更已接入历史记录。
*   [x] **功能点：提供快捷键提示与支持** - 已实现。全局快捷键 (新建、撤销) 和卡片内快捷键 (新增子项、批量完成) 均已实现，并在 UI 中提供了文字提示。
*   [x] **验收标准：支持导出 CSV** - 已实现。 中的  能够生成包含父/子层级信息的 CSV。
*   [x] **验收标准：支持撤销最近一次操作** - 已实现。所有核心 CRUD 操作（新增/删除/编辑/完成）均可通过  函数记录历史，支持撤销。
*   [x] **验收标准：支持快捷键操作** - 已实现。相关  监听  事件，并触发对应操作。

### 5.3 问题清单

---

*   **Severity**: Blocker
*   **Category**: Test
*   **Location**: , 
*   **Problem**: 新增的导出功能核心逻辑  和  位于 ，但  文件中没有为这些公共函数添加任何单元测试。缺乏测试覆盖会使未来的代码变更面临回归风险。
*   **Fix**: 请在  中为  和  补充单元测试用例，覆盖包括空列表、单层列表、多层嵌套列表以及标题中包含特殊字符（如逗号、引号）的边界场景。
*   **Acceptance Criteria**:  运行时，新增的测试用例能够成功执行并通过，有效验证 CSV 导出逻辑的正确性。

---

*   **Severity**: Blocker
*   **Category**: Code Quality / System Bug
*   **Location**:  (TodoItem component, lines 559-579)
*   **Problem**: 在  组件中，用于处理快捷键的  依赖数组中包含了  和  函数。这两个函数是在  组件渲染时内联定义的，并未用  包裹，导致它们的引用在每次父组件重渲染时都会改变。这将致使  在每次渲染时都错误地移除并重新绑定键盘事件监听器，造成不必要的性能开销和潜在的内存泄漏风险。
*   **Fix**: 使用  记忆  和  函数，确保它们的引用在依赖未变时保持稳定。
    
*   **Acceptance Criteria**: 将  和  函数用  包裹后，快捷键功能依然正常，并且事件监听器不会在每次无关的重渲染中被重复绑定。

---

*   **Severity**: Blocker
*   **Category**: Security / DX
*   **Location**: 
*   **Problem**: CI 工作流中为  步骤增加了一个 。使用自定义的个人访问令牌（PAT）相比默认的  存在几个风险：1) 权限过大：该令牌可能拥有超出“评论 PR”所需的过多权限；2) 安全管理：需要额外管理一个 Secret，增加了泄露风险。默认的  已拥有向 PR 写入评论的权限。
*   **Fix**: 移除  这一行。如果需要特定权限，请在工作流的  块中为  明确设置为 。如果使用自定义 token 是为了触发其他工作流，请在注释中明确说明原因。
*   **Acceptance Criteria**: 移除该 token 后，CI 工作流依然可以成功执行，并能将审计报告作为评论发布到 PR 中。

---

*   **Severity**: Minor
*   **Category**: Product Gap
*   **Location**: 
*   **Problem**: 当前的撤销功能实现将历史记录存储在组件的 state 中，这意味着当用户刷新页面时，所有的撤销历史都会丢失。同时，功能只支持“撤销”（Undo），不支持“重做”（Redo）。
*   **Fix**:
    1.  （可选，作为改进）可以考虑将撤销历史同步到 ，使其在页面刷新后依然存在。
    2.  （可选，作为改进）可以扩展历史记录 state，增加一个  或  数组来支持重做功能。
*   **Acceptance Criteria**: 用户刷新页面后，撤销历史依然可用（如果选择实现持久化）。用户可以撤销一个操作，然后再重做它。*（鉴于当前需求，此项为建议，非合并阻断项）*

---

*   **Severity**: Minor
*   **Category**: Code Quality
*   **Location**: 
*   **Problem**: 项目中现在存在多个全局  事件监听器：一个在  组件中，另一个在每个  组件实例中。虽然  内部的监听器通过  做了范围限制，但为每个列表项都注册一个全局监听器在列表很长时是低效的。
*   **Fix**: 建议将所有快捷键的监听逻辑统一到  的单个  中。通过检查  来判断事件源，并根据源的位置（例如，是否在某个  卡片内，可以通过  API 查找）来分发执行对应的操作（如新增子项）。
*   **Acceptance Criteria**: 重构后，只有一个全局键盘事件监听器。所有快捷键功能（全局和卡片内）保持不变。

### 5.4 建议的回归测试清单

*   **必跑命令**:
    *   
    *   
    *   
    *   
    *   
*   **建议增加的用例**:
    1.  **CSV 导出**:
        *   测试：导出一个包含多层嵌套 TODO 的列表。
        *   验证：CSV 文件内容正确， 字段能准确反映层级关系，特殊字符（逗号、引号）被正确转义。
    2.  **撤销功能**:
        *   测试：依次执行“添加”、“完成”、“编辑”、“删除”一个 TODO，然后依次撤销这些操作。
        *   验证：每一步撤销后，应用状态都能正确回滚到上一个状态。
        *   测试：连续撤销超过历史记录上限（20次）。
        *   验证：应用状态停留在最旧的历史记录点，且不会出错。
    3.  **快捷键**:
        *   测试：按下 。
        *   验证：页面焦点自动移动到“新建父 TODO”的输入框。
        *   测试：在  卡片内的输入框聚焦时，按下 。
        *   验证：成功为当前 TODO 添加一个新的子项。
        *   测试：在  卡片内，选中几个子项后，按下 。
        *   验证：选中的子项被批量标记为完成。
        *   测试：在文本输入框中按下 。
        *   验证：触发的是输入框自身的撤销，而不是应用的全局撤销。

